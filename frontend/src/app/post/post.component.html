<div>
    
    <div *ngFor="let post of posts ;let i = index" class="d-flex flex-column mt-4 mb-4">
    
        <div class="card">
          <a routerLink="post/{{post.post_id}}">
            <div class="card-header p-3">
                <div class="d-flex flex-row align-items-center">
                    <div
                        class="rounded-circle overflow-hidden d-flex justify-content-center align-items-center border border-danger post-profile-photo mr-3">
                        <img src="{{post.profileImage}}" alt="..."
                            style="transform: scale(1.5); width: 100%; position: absolute; left: 0">
                    </div>
                    <span class="font-weight-bold px-2">{{post.creator_username}} <span style="color: Dodgerblue;"> <i class="fa-solid fa-circle-check"></i> </span></span>
<span class="text-muted"> &middot; </span>
<span class="text-muted">Recent</span>
                </div>
            </div>
          </a>
            <div class="card-body p-0">
              <ng-container *ngIf="post.mediaFiles.length > 1; else singleMedia">
                <!-- Carousel for multiple images -->
                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                  <ol class="carousel-indicators">
                      <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                      <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                      <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                  </ol>
                  <div class="carousel-inner">
                      <div  class="carousel-item active">
                          <img class="d-block w-100" src="https://png.pngtree.com/background/20230613/original/pngtree-four-beautiful-african-women-picture-image_3386578.jpg" alt="First slide">
                          <!-- <div class="carousel-caption d-none d-md-block">
                              <h5>My Caption Title (1st Image)</h5>
                              <p>The whole caption will only show up if the screen is at least medium size.</p>
                          </div> -->
                      </div>
                      <div class="carousel-item">
                          <img class="d-block w-100" src="https://guardian.ng/wp-content/uploads/2021/06/Wodaabe-Tribe.-Photo-Liba-Taylor-Alamy-Stock-Photo-e1624874795586.jpeg" alt="Second slide">
                      </div>
                      <div class="carousel-item">
                          <img class="d-block w-100" src="https://www.ucf.edu/wp-content/blogs.dir/4/files/2020/10/FA2020-WhyI-1600x900.jpg" alt="Third slide">
                      </div>
                  </div>
                  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="sr-only">Previous</span>
                  </a>
                  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="sr-only">Next</span>
                  </a>
              </div>
              </ng-container>
              <ng-template #singleMedia>
                <ng-container *ngIf="post.mediaFiles.length == 1">

                    <img [src]="post.mediaFiles[0].media_file" alt="Post Media" class="d-block w-100" style="max-height: 560px;">
                 
                </ng-container>
              </ng-template>
    
                <div class="d-flex flex-row justify-content-between pl-3 pr-3 pt-3 pb-1">
                    <ul class="list-inline d-flex flex-row align-items-center m-0">
                        <li class="list-inline-item">
                            <button class="btn p-0" (click)="toggleLike(post)">
                              <span *ngIf="post.liked">
                                <i class="fa-solid fa-heart"  style="color: red;"></i>
                          
                              </span>
                              <span *ngIf="!post.liked">
                                <i class="fa-regular fa-heart"></i>
                              </span>
                              
                            </button>
                        </li>
                        <li class="list-inline-item ml-2">
                            <button class="btn p-0"  data-bs-toggle="modal" [attr.data-bs-target]="'#post_' + post.post_id">
                              <i class="fa-regular fa-comment"></i>
                            </button>
                        </li>
                        <li *ngIf="post.created_by_user_id === user_id" class="list-inline-item ml-2">
                            <button class="btn p-0" data-bs-toggle="modal" [attr.data-bs-target]="'#edit_' + post.post_id">
                              <i class="fa-solid fa-pen-to-square"></i>
                            
                            </button>
                        </li>
                    </ul>
                    <div>
                      <button *ngIf="post.created_by_user_id === user_id" class="btn p-0 m-2" (click)="deletePost(post)">
                      
                        <span>
                          <i class="fa-solid fa-trash" style="color: red;"></i>
                        </span>
                      </button>
                    </div>
                    
                </div>
    
                <div class="pl-3 pr-3 pb-2">
                   <small> <strong class="d-block">{{ post.likes.length }} likes</strong></small>
                  
                    <small class="d-block mb-1">{{ post.caption }}</small>
              
                        <span class="text-muted" data-bs-toggle="modal" style="cursor: pointer;" data-bs-target="#comments">View all {{post.comments.length}} comments</span>
                   
    
                   
    
                  
                </div>
    
                <div class="position-relative comment-box" >
                  <form>
                    <input class="w-100 border-0 p-3 input-post" placeholder="Add a comment..."
                           type="text" [name]="'textarea2_' + i"
                           [(ngModel)]="post.comment">
                    <button (click)="postComment(post)" class="btn btn-primary position-absolute btn-ig">Post</button>
                  </form>
                </div>
                
    
    
            </div>
         
        </div>
      
    </div>

  
  
</div>


<div *ngFor="let post of posts;let i = index">
    <div class="modal fade" [id]="'post_' + post.post_id">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
  
       
  
          <!-- Modal body -->
          <div class="modal-body p-2">
            <div class="d-flex">
<div class="w-50">
  
  <img [src]="post.mediaFiles[0].media_file" alt="Post Media" class="d-block w-100">

</div>
<div class="w-50">
  <div class="w-100 position-relative">
    <div class="d-flex flex-row align-items-center">
      <div
          class="rounded-circle overflow-hidden d-flex justify-content-center align-items-center border border-danger post-profile-photo mr-3">
          <img src="{{post.profileImage}}" alt="..."
              style="transform: scale(1.5); width: 100%; position: absolute; left: 0">
      </div>
      <span class="font-weight-bold px-2">{{post.creator_username}} <span style="color: Dodgerblue;"> <i class="fa-solid fa-circle-check"></i> </span></span>
<span class="text-muted"> &middot; </span>
<!-- <span class="text-muted">{{post.created_at}}</span> -->
  </div>    
              
    <!-- Content container for comments and other elements -->
    <div class="ml-auto">
      <!-- List of comments (scrollable) -->
      <div class="comments-container overflow-auto" style="max-height: 400px;">
        <div>
         
           
              <div class="row w-100 d-flex justify-content-center">
                <div class="col-12">
                  <div class="card">
                    <div class="card-body">
                      
          
                      <div class="row w-100" *ngFor="let entry of post.comments">
                        <!-- Entry -->
                        <div class="col">
                          <div class="d-flex flex-start">
                            <img class="rounded-circle shadow-1-strong me-3" [src]="entry.profileImage" alt="avatar" width="65" height="65" />
                            <div class="flex-grow-1 flex-shrink-1">
                              <div>
                                <div class="d-flex justify-content-between align-items-center">
                                  <p class="mb-1">
                                    <span class="font-weight-bold">{{ entry.comment_creator_username }}</span>
                                    <span class="small">   {{ entry.comment }}</span>
                                  </p>

                                </div>
                              
                                <div>
                                  <p class="text-muted">
                                  

                                    <small class="text-muted mx-2" *ngIf="entry.created_by_user_id == user_id" (click)="replyToComment(post,entry,false)" style="cursor: pointer;">
                                      Edit 
                                    </small>

                                    <small class="text-muted mx-2"   (click)="replyToComment(post,entry,true)" style="cursor: pointer;">
                                      Reply 
                                    </small>
                                
                                    <small class="text-muted mx-2" *ngIf="entry.created_by_user_id == user_id" (click)="deleteEntry(entry.comment_id,i)" style="cursor: pointer;">
                                     Delete
                                    </small>
                                  </p>
                                </div>
                               
                              </div>
                              
              
                              <!-- Replies -->
                              <div class="d-flex flex-start mt-4" *ngFor="let reply of entry.subcomments">
                                <a class="me-3" href="#">
                                  <img class="rounded-circle shadow-1-strong" [src]="reply.profileImage" alt="avatar" width="40" height="40" />
                                </a>
                                <div class="flex-grow-1 flex-shrink-1">
                                  <div>
                                    <div class="d-flex justify-content-between align-items-center">
                                      <p class="mb-1">
                                        {{ reply.comment_creator_username }} 
                                      </p>
                                    </div>
                                    <p class="small mb-0">
                                     {{ reply.comment }}
                                    </p>
                                  </div>
                                </div>
                              </div>
                              <!-- End Replies -->
                            </div>
                          </div>
                        </div>
                        <hr/>
                        <!-- End Entry -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
           
      

          </div>
      </div>

      <div class="position-relative comment-box" >
        <form>
          <input class="w-100 border-0 p-3 input-post" placeholder="Add a comment..."
                 type="text" [name]="'textarea2_' + i"
                 [(ngModel)]="replyToUsername">
          <button (click)="sendCommentOnComment(post,false)" class="btn btn-primary position-absolute btn-ig">Post</button>
        </form>
      </div>
       
    </div>
  </div>  
</div>
            </div>
          
            <!-- Comments on the right -->
                  
            
            </div>
  
        </div>
      </div>
    </div>
  </div>

  <div *ngFor="let post of posts;let i = index">
    <div class="modal fade" [id]="'edit_' + post.post_id">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
  
       
  
          <!-- Modal body -->
          <div class="modal-body p-2">
            <div class="d-flex">
<div class="w-50">
  
  <img [src]="post.mediaFiles[0].media_file" alt="Post Media" class="d-block w-100">

</div>
<div class="w-50">
  <div class="w-100 position-relative">
    <div class="d-flex flex-row align-items-center">
      <div
          class="rounded-circle overflow-hidden d-flex justify-content-center align-items-center border border-danger post-profile-photo mr-3">
          <img src="{{post.profileImage}}" alt="..."
              style="transform: scale(1.5); width: 100%; position: absolute; left: 0">
      </div>
      <span class="font-weight-bold px-2">{{post.creator_username}} <span style="color: Dodgerblue;"> <i class="fa-solid fa-circle-check"></i> </span></span>
<span class="text-muted"> &middot; </span>
<!-- <span class="text-muted">{{post.created_at}}</span> -->
  </div>    
              
    <!-- Content container for comments and other elements -->
    <div class="ml-auto">
      <!-- List of comments (scrollable) -->
      <div class="comments-container overflow-auto" style="max-height: 400px;">
        <div>
         
           
              <div class="row w-100 d-flex justify-content-center">
                <div class="col-12">
                  <div class="card">
                    <div class="card-body">
                      
          
                      <form [formGroup]="editPostForm" (ngSubmit)="editPost(post.post_id)">

                        <div class="row">
                          <div class="col-12">
                            <div class="form-group">
                           
                            </div>
                          </div>
                      
                          <div class="col-12">
                            <div class="row">
                                               
    
                              <div class="row">
                                <div class="col-12">
                                  <div class="form-group">
                                    <input type="text" class="form-control w-100 p-3 input-post" placeholder="Add a comment..." formControlName="caption"  [(ngModel)]="post.caption">
                                  </div>
                                </div>
                               
                              </div>
                              
                      
                              <div class="col-12">
                                <button type="submit"  data-bs-dismiss="modal" class="btn btn-primary btn-block w-100">Update</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      
                      </form>
                    </div>
                  </div>
                </div>
              </div>
           
      

          </div>
      </div>
    </div>
  </div>  
</div>
            </div>
          
            <!-- Comments on the right -->
                  
            
            </div>
  
        </div>
      </div>
    </div>
  </div>




  <div class="modal fade" id="share">
    <div class="modal-dialog">
        <div class="modal-content">
    
          <!-- Modal Header -->
          <div class="modal-header text-center">
            <h4 class="modal-title">Share</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
    
          <!-- Modal body -->
          <div class="modal-body p-2">
            <!-- "To:" label and input -->
            <div class="form-group d-flex align-items-center">
                <label for="recipientInput" class="mr-2">To:</label>
                <input type="text" class="form-control border-0" id="recipientInput" [(ngModel)]="searchQuery" placeholder="Search users..." (input)="searchUsers()">
              </div>
          
            <!-- List of users with profile pics, names, and usernames -->
            <div class="list-group">
              <div *ngFor="let user of searchResults" class="d-flex flex-row justify-content-between align-items-center mt-3 mb-3">
                <div class="d-flex flex-row align-items-center">
                  <div class="rounded-circle overflow-hidden d-flex justify-content-center align-items-center border sugest-profile-photo">
                    <img src="{{ user.profileImage }}" alt="..." style="transform: scale(1.5); width: 100%; position: absolute; left: 0;">
                  </div>
                  <strong class="ml-3 sugest-username">{{ user.username }}</strong>
                </div>
              </div>
              

             
        
      </div>
          </div>
          
    
        
    
        </div>
      </div>
  </div>


  <div class="modal fade" id="add_post">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
  
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Add Post</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
        
              <!-- Modal body -->
              <div class="modal-body">
                <form [formGroup]="postForm" (ngSubmit)="sharePost()">

                    <div class="row">
                      <div class="col-12">
                        <div class="form-group">
                          <ngx-dropzone (change)="onSelectPostImage($event)">
                            <ngx-dropzone-label>Drop Post Image</ngx-dropzone-label>
                            <ngx-dropzone-preview *ngFor="let f of postFiles" [removable]="true" (removed)="onRemovePostImage(f)">
                              <ngx-dropzone-label>{{ f.name }} ({{ f.type }})</ngx-dropzone-label>
                            </ngx-dropzone-preview>
                          </ngx-dropzone>
                        </div>
                      </div>
                  
                      <div class="col-12">
                        <div class="row">
                          <div class="col-12">
                            <label for="postType">Post Type</label>
                            <select class="form-control" formControlName="postType" id="postType">
                              <option value="post">Post</option>
                              <option value="Status">Status</option>
                            </select>
                          </div>
                  

                          <div class="row">
                            <div class="col-12">
                              <div class="form-group">
                                <input type="text" class="form-control w-100 p-3 input-post" placeholder="Add a comment..." formControlName="caption">
                              </div>
                            </div>
                            <!-- <div class="col-2">
                              <div class="input-group">
                                <div class="input-group-append">
                                  <button data-toggle="collapse" class="btn" data-bs-toggle="collapse" data-bs-target="#emoji" aria-expanded="false" type="button">😀</button>
                                </div>
                                <div id="emoji" class="collapse">
                                  <div class="form-group">
                                    <emoji-mart
                                      class="emoji-mart w-100"
                                      (emojiSelect)="addEmoji($event)"
                                      title="Choose your emoji"
                                    ></emoji-mart>
                                  </div>
                                </div>
                              </div>
                            </div> -->
                          </div>
                          
                  
                          <div class="col-12">
                            <button type="submit"  data-bs-dismiss="modal" class="btn btn-primary btn-block w-100">Share</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  
                  </form>
                  
              </div>
  
      </div>
    </div>
  </div>